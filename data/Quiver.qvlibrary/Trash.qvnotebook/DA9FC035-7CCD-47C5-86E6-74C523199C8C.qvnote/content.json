{
  "title": "1.1 hive基本操作",
  "cells": [
    {
      "type": "text",
      "data": "<div style=\"word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; white-space: normal;\"><div>1.HIVE不支持更新（update），删除（delete）操作</div><div>2.由于HIVE必须要走mapreduce，所以HIVE处理小数据量时速度较慢</div><div>3.HIVE不适合作为OLTP系统</div><div>4.HIVESQL的语法接近MYSQL 语法</div><div><br/></div><div><br/></div><div>启动hive客户端</div><div>hive</div><div>退出</div><div>quit</div><div>exit</div><div><br/></div><div>非客户的执行SQL</div><div>hive -e &apos;select * from dw.bas_hotel_user_info_d limit 10&apos;</div><div>执行SQL文本</div><div>hive -f aaa.sql</div><div><br/></div><div><br/></div><div>显示所有库</div><div>show databases;</div><div><br/></div><div>进入数据库</div><div>use dw;</div><div>查询表</div><div>show tables;</div><div>show tables &apos;*user*&apos;; --模糊查询某个表名</div><div>查询表字段结构</div><div>desc bas_hotel_user_info_d;</div><div>查询建表语句</div><div>show create table bas_hotel_user_info_d;</div><div>查询表分区</div><div>show partitions bas_hotel_user_info_d;</div><div>查询所有函数</div><div>show functions;</div><div>desc function base64; --查询函数的具体用法</div><div><br/></div><div><br/></div><div><br/></div><div>----建表</div><div>create table ods_call_tele_wz_kddc_d&nbsp; --内部表</div><div>(</div><div>&nbsp; &nbsp;day_id&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;date&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;comment &apos;数据日期&apos;,</div><div>&nbsp; &nbsp;data_time&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; timestamp&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;comment &apos;数据时间&apos;,</div><div>&nbsp; &nbsp;name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;string&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; comment &apos;姓名&apos;,</div><div>&nbsp; &nbsp;mobile&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;string&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; comment &apos;手机号码&apos;,</div><div>&nbsp; &nbsp;phone_num&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; comment &apos;固定电话&apos;,</div><div>&nbsp; &nbsp;sex&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; comment &apos;性别&apos;,</div><div>&nbsp; &nbsp;city_id&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; comment &apos;城市ID&apos;,</div><div>&nbsp; &nbsp;area_id&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; comment &apos;区县ID&apos;</div><div>)comment &apos;温州电信宽带客户调查&apos;</div><div>&nbsp;partitioned by(pt_date string comment &apos;日期分区字段&apos;)</div><div>&nbsp;row format delimited</div><div>&nbsp;fields terminated by &apos;\\t&apos;</div><div>&nbsp;lines terminated by &apos;\\n&apos;</div><div>&nbsp;stored as textfile&nbsp; ;</div><div>&nbsp;/aaa/pt_date=20150101/pt_hour=01/</div><div>&nbsp;partitioned by(pt_date string comment &apos;日期分区字段&apos;,pt_hour string comment &apos;小时分区&apos;)</div><div><br/></div><div><br/></div><div>&nbsp;hadoop fs -put aa.log /hive/warehouse/ods.db/ods_call_tele_wz_kddc_d/pt_date=20131030/</div><div><br/></div><div><br/></div><div><br/></div><div>&nbsp;create external table ods.ods_call_tele_wz_kddc_d --外部表</div><div>&nbsp;(</div><div>&nbsp; &nbsp;day_id&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;date&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;comment &apos;数据日期&apos;,</div><div>&nbsp; &nbsp;data_time&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; timestamp&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;comment &apos;数据时间&apos;,</div><div>&nbsp; &nbsp;name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;string&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; comment &apos;姓名&apos;,</div><div>&nbsp; &nbsp;mobile&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;string&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; comment &apos;手机号码&apos;,</div><div>&nbsp; &nbsp;phone_num&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; comment &apos;固定电话&apos;,</div><div>&nbsp; &nbsp;sex&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; comment &apos;性别&apos;,</div><div>&nbsp; &nbsp;city_id&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; comment &apos;城市ID&apos;,</div><div>&nbsp; &nbsp;area_id&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; comment &apos;区县ID&apos;</div><div>)comment &apos;温州电信宽带客户调查&apos;</div><div>&nbsp;partitioned by(pt_date string comment &apos;日期分区字段&apos;)</div><div>&nbsp;row format delimited</div><div>&nbsp;fields terminated by &apos;\\t&apos;</div><div>&nbsp;lines terminated by &apos;\\n&apos;</div><div>&nbsp;stored as textfile</div><div>&nbsp;loction &apos;/hive/warehouse/ods.db/ods_call_tele_wz_kddc_d/&apos; ;</div><div><br/></div><div>创建同样表结构的表</div><div>create table dm_call_beibeile_d_niu_result like dm_call_beibeile_d_niu</div><div><br/></div><div>&nbsp;--表名重命名</div><div>&nbsp;alter table ods_call_tele_wz_kddc_d&nbsp; rename to ods_call_table;</div><div>&nbsp;--增加分区</div><div>&nbsp;alter table ods_call_tele_wz_kddc_d add partition (pt_date=&apos;20131030&apos;) [loction &apos;....&apos;];</div><div>&nbsp;--删除某个分区</div><div>&nbsp;alter table ods_call_tele_wz_kddc_d drop partition (pt_date=&apos;20150101&apos;)</div><div>&nbsp;---修改表字段</div><div>alter table ods_call_zbfc_d&nbsp; change&nbsp; &nbsp;sex&nbsp; &nbsp;sex&nbsp; string&nbsp; comment &apos;性别&apos;;</div><div>---修改表备注</div><div>alter table ods_call_zbfc_d set TBLPROPERTIES (&apos;comment&apos;=&apos;浙报房产邀约&apos;);</div><div><br/></div><div>&nbsp;--本地文本数据加载到hive表</div><div>&nbsp; &nbsp;--1</div><div>&nbsp;hive&gt;load data local inpath &apos;..../.../..&apos; overwrite into table table1 partition (pt_date=&apos;20150101&apos;)</div><div>&nbsp; &nbsp;--2</div><div>&nbsp;hadoop fs -put /home/hadoop/ods_call_tele_wz_kddc_d.txt /hive/warehouse/ods.db/ods_call_tele_wz_kddc_d/pt_date=20131030/</div><div>&nbsp;hive&gt;alter table ods_call_tele_wz_kddc_d add partition (pt_date=&apos;20150101&apos;)</div><div><br/></div><div>&nbsp;--插入数据</div><div>&nbsp; &nbsp;--插入到指定分区</div><div>&nbsp;insert overwrite table table1 partition (pt_date=&apos;20150101&apos;) select a,b,c from table2 ;</div><div>&nbsp; &nbsp;--插入到动态分区</div><div>&nbsp;[set hive.exec.dynamic.partition.mode=nostrick;]</div><div>&nbsp;insert overwrite table table1 partition (month) select a,b,c,month(a) from table2 ;</div><div><br/></div><div>&nbsp;---处理null值</div><div>ALTER TABLE src_report_h SET SERDEPROPERTIES(&apos;serialization.null.format&apos; = &apos;&apos;);</div><div><br/></div><div>\\N=null&nbsp; &nbsp;coalesce(tirm(b),&apos;&apos;) &lt;&gt;&apos;&apos;</div><div>&apos;&apos;</div><div><br/></div><div>---增加python函数处理</div><div>ADD FILE /ftp_samba/72/etl/py_src/report_game_split.py;</div><div>select</div><div>&nbsp; &nbsp; &nbsp; transform(data_time,game_id,launch_count,bar_id,city_id,mac,guid,ip,qq,passport_id,client_ver,&apos;-1&apos;)</div><div>&nbsp; &nbsp; &nbsp; using &apos;report_game_split.py&apos;</div><div>&nbsp; &nbsp; &nbsp; as data_time,game_id,launch_count,bar_id,city_id,mac,guid,ip,qq,passport_id,client_ver,file_ver</div><div>from src_report_h_mid a</div><div>where a.hour=${hour_desc};</div><div>a 1000,1001,1002</div><div>b 1000,1010</div><div>c 1010,1002,1001</div><div><br/></div><div>---字段拆分</div><div>select</div><div>&nbsp; a,</div><div>&nbsp; result.key as b</div><div>from (select &apos;a&apos; as a ,&apos;12,23,34,45&apos; as b ) z</div><div>lateral view explode(split(b,&apos;,&apos;)) result as key;</div><div><br/></div><div>--大小表查询优化</div><div>select</div><div>&nbsp; /*mapjoin(p2,p3)*/</div><div>&nbsp; p1.a,p1.b,p2.c</div><div>&nbsp; from table1 p1</div><div>&nbsp; left outer join</div><div>&nbsp; table2 p2</div><div>&nbsp; on p1.a=p2.a</div><div>&nbsp; left outer join</div><div>&nbsp; table3 p3</div><div>&nbsp; on p1.a=p3.a</div><div><br/></div><div>ALTER TABLE</div><div>out_person_info_result</div><div>ADD PARTITION (pt_date=&apos;20160715&apos;)</div><div>LOCATION &apos;/hive/warehouse/dm.db/out_person_info_result/pt_date=20160715&apos;;</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div>"
    }
  ]
}