{
  "title": "数据去重",
  "cells": [
    {
      "type": "text",
      "data": "<div style=\"word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; white-space: normal;\"><div><p style=\"box-sizing: border-box; margin: 0px 0px 10px; color: rgb(97, 97, 97); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);\">这几天我一直在研究Hive，我们今天看一个新的知识，<strong style=\"box-sizing: border-box; font-weight: bold;\">Hive去重复数据</strong>。</p><p style=\"box-sizing: border-box; margin: 0px 0px 10px; color: rgb(97, 97, 97); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);\">Hive数据去重</p><p style=\"box-sizing: border-box; margin: 0px 0px 10px; color: rgb(97, 97, 97); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);\">Sql代码 &nbsp;<img src='quiver-image-url/55EB9A99292517E853B6A4F5EF4C4E57' alt='收藏代码' style='box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; height: auto;'></p><ol start=\"1\" style=\"box-sizing: border-box; margin-top: 0px; margin-bottom: 10px; color: rgb(97, 97, 97); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);\"><li style=\"box-sizing: border-box;\">insert&nbsp;overwrite&nbsp;table&nbsp;store&nbsp;&nbsp;&nbsp;&nbsp;</li><li style=\"box-sizing: border-box;\">&nbsp;&nbsp;select&nbsp;t.p_key,t.sort_word&nbsp;from&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li style=\"box-sizing: border-box;\">&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;select&nbsp;p_key,&nbsp;&nbsp;&nbsp;&nbsp;</li><li style=\"box-sizing: border-box;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sort_word&nbsp;,&nbsp;&nbsp;&nbsp;&nbsp;</li><li style=\"box-sizing: border-box;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_number()&nbsp;over(distribute&nbsp;by&nbsp;p_key&nbsp;sort&nbsp;by&nbsp;sort_word)&nbsp;as&nbsp;rn&nbsp;&nbsp;&nbsp;</li><li style=\"box-sizing: border-box;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;store)&nbsp;t&nbsp;&nbsp;&nbsp;&nbsp;</li><li style=\"box-sizing: border-box;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;t.rn=1;&nbsp;&nbsp;&nbsp;&nbsp;</li></ol><p style=\"box-sizing: border-box; margin: 0px 0px 10px; color: rgb(97, 97, 97); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);\"><br style=\"box-sizing: border-box;\"/>\n说明：</p><ul style=\"box-sizing: border-box; margin-top: 0px; margin-bottom: 10px; color: rgb(97, 97, 97); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);\"><li style=\"box-sizing: border-box;\">p_key为去重所依据的key，sort_word表示多个p_key的排列顺序，这个关键字将决定哪个p_key将留下。</li><li style=\"box-sizing: border-box;\">t 为子查询的别名，Hive需要在每个子查询后面加别名</li><li style=\"box-sizing: border-box;\">t.rn=1表示重复的数据只保留第一个。</li><li style=\"box-sizing: border-box;\">distribute by 关键字指定分发的key，同一个key将分发到同一个reducer</li><li style=\"box-sizing: border-box;\">sort by 是单机范围内排序，因此配合distribute by 就可以对某一个关键字排序</li></ul><p style=\"box-sizing: border-box; margin: 0px 0px 10px; color: rgb(97, 97, 97); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);\">Hive数据去重</p><p style=\"box-sizing: border-box; margin: 0px 0px 10px; color: rgb(97, 97, 97); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);\">Sql代码 &nbsp;<img src='quiver-image-url/55EB9A99292517E853B6A4F5EF4C4E57' alt='收藏代码' style='box-sizing: border-box; border: 0px; vertical-align: middle; max-width: 100%; height: auto;'></p><ol start=\"1\" style=\"box-sizing: border-box; margin-top: 0px; margin-bottom: 10px; color: rgb(97, 97, 97); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);\"><li style=\"box-sizing: border-box;\">insert&nbsp;overwrite&nbsp;table&nbsp;store&nbsp;&nbsp;&nbsp;&nbsp;</li><li style=\"box-sizing: border-box;\">&nbsp;&nbsp;select&nbsp;t.p_key,t.sort_word&nbsp;from&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li style=\"box-sizing: border-box;\">&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;select&nbsp;p_key,&nbsp;&nbsp;&nbsp;&nbsp;</li><li style=\"box-sizing: border-box;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sort_word&nbsp;,&nbsp;&nbsp;&nbsp;&nbsp;</li><li style=\"box-sizing: border-box;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row_number()&nbsp;over(distribute&nbsp;by&nbsp;p_key&nbsp;sort&nbsp;by&nbsp;sort_word)&nbsp;as&nbsp;rn&nbsp;&nbsp;&nbsp;</li><li style=\"box-sizing: border-box;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;store)&nbsp;t&nbsp;&nbsp;&nbsp;&nbsp;</li><li style=\"box-sizing: border-box;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;t.rn=1;&nbsp;&nbsp;&nbsp;&nbsp;</li></ol><p style=\"box-sizing: border-box; margin: 0px 0px 10px; color: rgb(97, 97, 97); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);\"><br style=\"box-sizing: border-box;\"/>\n说明：</p><ul style=\"box-sizing: border-box; margin-top: 0px; margin-bottom: 10px; color: rgb(97, 97, 97); font-family: &amp;quot;microsoft yahei&amp;quot;; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);\"><li style=\"box-sizing: border-box;\">p_key为去重所依据的key，sort_word表示多个p_key的排列顺序，这个关键字将决定哪个p_key将留下。</li><li style=\"box-sizing: border-box;\">t 为子查询的别名，Hive需要在每个子查询后面加别名</li><li style=\"box-sizing: border-box;\">t.rn=1表示重复的数据只保留第一个。</li><li style=\"box-sizing: border-box;\">distribute by 关键字指定分发的key，同一个key将分发到同一个reducer</li><li style=\"box-sizing: border-box;\">sort by 是单机范围内排序，因此配合distribute by 就可以对某一个关键字排序</li></ul><div style=\"box-sizing: border-box;\"><div><br/></div><div>select t.city_id,t.city_name from&nbsp;</div><div>&nbsp; &nbsp; &nbsp;(select city_id, city_name, row_number() over(distribute by city_id sort by city_id) as rn</div><div>&nbsp; &nbsp; &nbsp;from dmn.dmn_area) t&nbsp; &nbsp;</div><div>&nbsp; &nbsp; &nbsp;where t.rn=1</div></div></div></div>"
    }
  ]
}